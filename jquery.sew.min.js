Array.prototype.filter||(Array.prototype.filter=function(t){"use strict";if(null===this)throw new TypeError;var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var s,n=[],o=arguments[1],r=0;i>r;r++)r in e&&(s=e[r],t.call(o,s,r,e)&&n.push(s));return n}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var i,s;if(null===this)throw new TypeError("this is null or not defined");var n=Object(this),o=n.length>>>0;if("[object Function]"!=={}.toString.call(t))throw new TypeError(t+" is not a function");for(e&&(i=e),s=0;o>s;){var r;Object.prototype.hasOwnProperty.call(n,s)&&(r=n[s],t.call(i,r,s,n)),s++}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){"use strict";if(null==this)throw new TypeError;var e=Object(this),i=e.length>>>0;if(0===i)return-1;var s=0;if(arguments.length>1&&(s=Number(arguments[1]),s!=s?s=0:0!=s&&1/0!=s&&s!=-1/0&&(s=(s>0||-1)*Math.floor(Math.abs(s)))),s>=i)return-1;for(var n=s>=0?s:Math.max(i-Math.abs(s),0);i>n;n++)if(n in e&&e[n]===t)return n;return-1}),Array.prototype.map||(Array.prototype.map=function(t,e){var i,s,n;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),r=o.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(e&&(i=e),s=Array(r),n=0;r>n;){var h,l;n in o&&(h=o[n],l=t.call(i,h,n,o),s[n]=l),n++}return s}),function(t,e,i){function s(e,i){this.element=e,this.$element=t(e),this.$itemList=t(s.MENU_TEMPLATE),this.options=t.extend({},r,i),this.reset(),this._defaults=r,this._name=o,this.expression=RegExp("(?:^|\\b|\\s)"+this.options.token+"([\\w.]* ?[\\w.]*)$"),this.cleanupHandle=null,this.mentions=[],this.init()}var n=function(t,e){t.text(e.val)},o="sew",r=(e.document,{token:"@",elementFactory:n,values:[],unique:!1,repeat:!0});s.MENU_TEMPLATE="<div class='-sew-list-container' style='display: none; position: absolute;'><ul class='-sew-list'></ul></div>",s.ITEM_TEMPLATE='<li class="-sew-list-item"></li>',s.KEYS=[40,38,13,27,9],s.prototype.init=function(){this.options.values&&(this.filtered=[],this.$element.bind("keyup",t.proxy(this.onKeyUp,this)).bind("keydown",t.proxy(this.onKeyDown,this)).bind("focus",t.proxy(this.preRender,this)).bind("blur",t.proxy(this.remove,this)))},s.prototype.reset=function(){this.options.unique&&"function"!=typeof this.options.values&&(this.options.values=s.getUniqueElements(this.options.values)),this.index=0,this.matched=!1,this.dontFilter=!1,this.lastFilter=i,this.$selected=null},s.prototype.next=function(){this.index=(this.index+1)%this.filtered.length,this.hightlightItem()},s.prototype.prev=function(){this.index=(this.index+this.filtered.length-1)%this.filtered.length,this.hightlightItem()},s.prototype.select=function(){this.replace(this.filtered[this.index].val),this.$element.trigger("mention-selected",this.filtered[this.index]),this.mentions.push(this.filtered[this.index]),this.hideList()},s.prototype.remove=function(){this.$itemList.fadeOut("slow"),this.cleanupHandle=e.setTimeout(t.proxy(function(){this.$itemList.remove(),this.$itemListUL=null},this),500)},s.prototype.replace=function(t){var e,i=this.$element.getCursorPosition(),s=1===i?"":" ",n=this.getText(),o=n.substring(0,i),r=n.substring(i,n.length),h=r.match(/^\s/)?"":" ";o=o.replace(this.expression,s+this.options.token+t),e=o+h+r,this.setText(e),this.$element.setCursorPosition(o.length+1)},s.prototype.hightlightItem=function(){this.$selected&&this.$selected.removeClass("selected");var t=this.$itemListUL,e=this.filtered[this.index].element.addClass("selected"),i=e.position().top;this.$selected=e,t.scrollTop(t.scrollTop()+i)},s.prototype.preRender=function(){t("body").append(this.$itemList),this.$itemListUL=this.$itemList.find("ul").empty(),this.$selected=null},s.prototype.renderElements=function(e){var i,n,o,r,h=this.$itemListUL;if(h||(this.preRender(),h=this.$itemListUL),e)for(r=function(e,i){var n=t(s.ITEM_TEMPLATE);this.options.elementFactory(n,e),e.element=n.appendTo(h).bind("click",t.proxy(this.onItemClick,this,e)).bind("mouseover",t.proxy(this.onItemHover,this,i))},o=e.length,i=0;o>i;i+=1)n=e[i],r.call(this,n,i);this.index=0,this.hightlightItem()},s.prototype.displayList=function(){var t=this.$element,e=this.$element.offset(),i=t.getCaretPosition();this.$itemList.css({left:e.left+i.left,top:e.top+i.top+15}),this.$element.trigger("menu_show"),this.filtered.length&&this.$itemList.show()},s.prototype.hideList=function(){var t=this;this.$itemList.hide(),this.reset(),setTimeout(function(){t.$element.trigger("menu_hide")},500)},s.prototype.getValues=function(t){return"function"==typeof this.options.values?this.options.values(t):this.options.values},s.prototype.filterList=function(e){if(e!=this.lastFilter){this.lastFilter=e,this.$itemList.find(".-sew-list-item").remove();var i,s=this.getValues(e);i=this.filtered="function"==typeof this.options.filter?this.options.filter.call(this,s,e):s.filter(t.proxy(function(t){var i=RegExp("\\W*"+this.options.token+t.val+"(\\W|$)");return!this.options.repeat&&this.getText().match(i)?!1:""===e||t.val.toLowerCase().indexOf(e.toLowerCase())>=0||(t.meta||"").toLowerCase().indexOf(e.toLowerCase())>=0},this)),i.length?(this.renderElements(i),this.$itemList.show()):this.hideList()}},s.getUniqueElements=function(t){var e=[];return t.forEach(function(t){var i=e.map(function(t){return t.val}).indexOf(t.val)>=0;i||e.push(t)}),e},s.prototype.getText=function(){return this.$element.val()||this.$element.text()},s.prototype.setText=function(e){this.$element.prop("tagName").match(/input|textarea/i)?this.$element.val(e):(e=t("<span>").text(e).html().replace(/\s/g,"&nbsp"),this.$element.html(e))},s.prototype.onKeyUp=function(){var t=this.$element.getCursorPosition();return val=this.getText().substring(0,t),matches=val.match(this.expression),!matches&&this.matched?(this.matched=!1,this.dontFilter=!1,this.hideList(),i):(matches&&!this.matched&&(this.displayList(),this.lastFilter="\n",this.matched=!0),matches&&!this.dontFilter&&this.filterList(matches[1]),i)},s.prototype.onKeyDown=function(t){var e=this.$itemList.is(":visible");if(e&&!(0>s.KEYS.indexOf(t.keyCode))){switch(t.keyCode){case 9:case 13:this.select();break;case 40:this.next();break;case 38:this.prev();break;case 27:this.$itemList.hide(),this.dontFilter=!0}t.preventDefault()}},s.prototype.onItemClick=function(){this.cleanupHandle&&e.clearTimeout(this.cleanupHandle),this.select()},s.prototype.onItemHover=function(t){this.index=t,this.hightlightItem()},s.prototype.getMentions=function(t){var e=this,i=[],s=this.getText(),n=this.mentions.filter(function(t){var i=RegExp("\\W*"+e.options.token+t.val+"(\\W|$)");return s.match(i)});n.forEach(function(t){var e=i.map(function(t){return t.val}).indexOf(t.val)>=0;e||(delete t.element,i.push(t))}),t.call(this,i)},s.prototype.setMentions=function(t){this.mentions=t},s.prototype.addMention=function(t){this.mentions.push(t)},t.fn[o]=function(e){var n=arguments;return this.each(function(){var r=t(this),h=r.data(o),l="object"==typeof e&&e;return h||r.data(o,h=new s(this,l)),"string"==typeof e?h[e].apply(t(this).data(o),Array.prototype.slice.call(n,1)):i})}}(jQuery,window);